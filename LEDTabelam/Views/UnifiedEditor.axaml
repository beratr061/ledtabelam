<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:LEDTabelam.ViewModels"
             xmlns:models="using:LEDTabelam.Models"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="400"
             x:Class="LEDTabelam.Views.UnifiedEditor"
             x:DataType="vm:UnifiedEditorViewModel">

    <Border Background="#2D2D2D" CornerRadius="8" Padding="8">
        <Grid ColumnDefinitions="240,*,220">
            
            <!-- Sol Panel: Program ve Ã–ÄŸe Listesi -->
            <Border Grid.Column="0" Background="#252525" CornerRadius="6" Padding="8" Margin="0,0,4,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="8">
                        
                        <!-- Program Listesi BÃ¶lÃ¼mÃ¼ -->
                        <!-- Requirements: 10.1, 10.2 -->
                        <StackPanel Spacing="4">
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBlock Grid.Column="0" Text="Programlar" FontWeight="SemiBold" Foreground="#E0E0E0" FontSize="12"/>
                                <TextBlock Grid.Column="1" Text="{Binding CurrentProgramDisplay}" Foreground="#808080" FontSize="10" VerticalAlignment="Center"/>
                            </Grid>
                            
                            <!-- Program Listesi -->
                            <ListBox ItemsSource="{Binding Programs}" 
                                     SelectedItem="{Binding SelectedProgram}"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     MaxHeight="120">
                                <ListBox.ItemTemplate>
                                    <DataTemplate DataType="models:TabelaProgram">
                                        <Border Background="{Binding IsActive, Converter={x:Static vm:BoolToSelectionBrushConverter.Instance}}"
                                                CornerRadius="4" Padding="6,4" Margin="0,1">
                                            <Grid ColumnDefinitions="Auto,*,Auto">
                                                <TextBlock Grid.Column="0" Text="ðŸ“‹" FontSize="10" Foreground="#808080" 
                                                           VerticalAlignment="Center" Margin="0,0,6,0"/>
                                                <StackPanel Grid.Column="1" Spacing="1">
                                                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="10" Foreground="#E0E0E0"/>
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <TextBlock FontSize="9" Foreground="#808080">
                                                            <TextBlock.Text>
                                                                <MultiBinding StringFormat="{}{0}sn">
                                                                    <Binding Path="DurationSeconds"/>
                                                                </MultiBinding>
                                                            </TextBlock.Text>
                                                        </TextBlock>
                                                        <TextBlock Text="â€¢" FontSize="9" Foreground="#606060"/>
                                                        <TextBlock FontSize="9" Foreground="#808080">
                                                            <TextBlock.Text>
                                                                <MultiBinding StringFormat="{}{0} Ã¶ÄŸe">
                                                                    <Binding Path="Items.Count"/>
                                                                </MultiBinding>
                                                            </TextBlock.Text>
                                                        </TextBlock>
                                                    </StackPanel>
                                                </StackPanel>
                                                <Border Grid.Column="2" Width="8" Height="8" CornerRadius="4" 
                                                        Background="{Binding IsActive, Converter={x:Static vm:BoolToPlayColorConverter.Instance}}"
                                                        VerticalAlignment="Center" Margin="4,0,0,0"
                                                        IsVisible="{Binding IsActive}"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                            
                            <!-- Program ButonlarÄ± -->
                            <StackPanel Orientation="Horizontal" Spacing="3">
                                <Button Content="+ Ekle" Command="{Binding AddProgramCommand}" Padding="6,3" FontSize="10" ToolTip.Tip="Yeni program ekle"/>
                                <Button Content="Sil" Command="{Binding RemoveProgramCommand}" Padding="6,3" FontSize="10" ToolTip.Tip="SeÃ§ili programÄ± sil"/>
                                <Button Content="â–²" Command="{Binding MoveProgramUpCommand}" Padding="6,3" FontSize="10" ToolTip.Tip="YukarÄ± taÅŸÄ±"/>
                                <Button Content="â–¼" Command="{Binding MoveProgramDownCommand}" Padding="6,3" FontSize="10" ToolTip.Tip="AÅŸaÄŸÄ± taÅŸÄ±"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Program DÃ¼zenleme AlanÄ± -->
                        <!-- Requirements: 2.5, 3.1 -->
                        <Border Background="#1E1E1E" CornerRadius="4" Padding="6" IsVisible="{Binding HasPrograms}">
                            <StackPanel Spacing="6">
                                <TextBlock Text="Program AyarlarÄ±" FontWeight="SemiBold" Foreground="#B0B0B0" FontSize="10"/>
                                
                                <!-- Program AdÄ± -->
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Ad" Foreground="#808080" FontSize="9"/>
                                    <TextBox Text="{Binding SelectedProgram.Name}" FontSize="10"/>
                                </StackPanel>
                                
                                <!-- Program SÃ¼resi -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <StackPanel Grid.Column="0" Spacing="2">
                                        <TextBlock Text="SÃ¼re (sn)" Foreground="#808080" FontSize="9"/>
                                        <Slider Minimum="1" Maximum="60" Value="{Binding SelectedProgram.DurationSeconds}" 
                                                TickFrequency="5" IsSnapToTickEnabled="False"/>
                                    </StackPanel>
                                    <TextBlock Grid.Column="1" Text="{Binding SelectedProgram.DurationSeconds, StringFormat={}{0}sn}" 
                                               Foreground="#B0B0B0" FontSize="10" VerticalAlignment="Bottom" Margin="4,0,0,0" Width="30"/>
                                </Grid>
                                
                                <!-- GeÃ§iÅŸ Tipi -->
                                <StackPanel Spacing="2">
                                    <TextBlock Text="GeÃ§iÅŸ Efekti" Foreground="#808080" FontSize="9"/>
                                    <ComboBox SelectedIndex="{Binding SelectedProgram.Transition, Converter={x:Static vm:ProgramTransitionToIndexConverter.Instance}}"
                                              SelectionChanged="OnProgramTransitionChanged"
                                              HorizontalAlignment="Stretch" FontSize="10">
                                        <ComboBoxItem Content="Direkt (Kesme)"/>
                                        <ComboBoxItem Content="Solma (Fade)"/>
                                        <ComboBoxItem Content="Sola Kayma"/>
                                        <ComboBoxItem Content="SaÄŸa Kayma"/>
                                        <ComboBoxItem Content="YukarÄ± Kayma"/>
                                        <ComboBoxItem Content="AÅŸaÄŸÄ± Kayma"/>
                                    </ComboBox>
                                </StackPanel>
                                
                                <!-- GeÃ§iÅŸ SÃ¼resi -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <StackPanel Grid.Column="0" Spacing="2">
                                        <TextBlock Text="GeÃ§iÅŸ SÃ¼resi (ms)" Foreground="#808080" FontSize="9"/>
                                        <Slider Minimum="200" Maximum="1000" Value="{Binding SelectedProgram.TransitionDurationMs}" 
                                                TickFrequency="100" IsSnapToTickEnabled="True"/>
                                    </StackPanel>
                                    <TextBlock Grid.Column="1" Text="{Binding SelectedProgram.TransitionDurationMs, StringFormat={}{0}ms}" 
                                               Foreground="#B0B0B0" FontSize="10" VerticalAlignment="Bottom" Margin="4,0,0,0" Width="40"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                        
                        <Border Height="1" Background="#3D3D3D"/>
                        
                        <!-- Ã–ÄŸeler BÃ¶lÃ¼mÃ¼ -->
                        <StackPanel Spacing="4">
                            <TextBlock Text="Ã–ÄŸeler" FontWeight="SemiBold" Foreground="#E0E0E0" FontSize="12"/>
                            
                            <!-- Ã–ÄŸe Listesi -->
                            <ListBox ItemsSource="{Binding Items}" 
                                     SelectedItem="{Binding SelectedItem}"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     MaxHeight="150">
                                <ListBox.ItemTemplate>
                                    <DataTemplate DataType="models:TabelaItem">
                                        <Border Background="{Binding IsSelected, Converter={x:Static vm:BoolToSelectionBrushConverter.Instance}}"
                                                CornerRadius="4" Padding="6,4" Margin="0,1">
                                            <Grid ColumnDefinitions="Auto,Auto,*,Auto">
                                                <TextBlock Grid.Column="0" FontSize="9" Foreground="#808080" 
                                                           VerticalAlignment="Center" Margin="0,0,4,0"
                                                           Text="{Binding ItemType, Converter={x:Static vm:ItemTypeToIconConverter.Instance}}"/>
                                                <Border Grid.Column="1" Width="10" Height="10" CornerRadius="2" Margin="0,0,6,0"
                                                        Background="{Binding Color, Converter={x:Static vm:ColorToBrushConverter.Instance}}"/>
                                                <StackPanel Grid.Column="2" Spacing="1">
                                                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="10" Foreground="#E0E0E0"/>
                                                    <TextBlock FontSize="9" Foreground="#808080" MaxWidth="100" TextTrimming="CharacterEllipsis">
                                                        <TextBlock.Text>
                                                            <MultiBinding Converter="{x:Static vm:ItemContentDisplayConverter.Instance}">
                                                                <Binding Path="ItemType"/>
                                                                <Binding Path="Content"/>
                                                                <Binding Path="SymbolName"/>
                                                            </MultiBinding>
                                                        </TextBlock.Text>
                                                    </TextBlock>
                                                </StackPanel>
                                                <TextBlock Grid.Column="3" FontSize="8" Foreground="#606060" VerticalAlignment="Center">
                                                    <TextBlock.Text>
                                                        <MultiBinding StringFormat="{}{0},{1}">
                                                            <Binding Path="X"/>
                                                            <Binding Path="Y"/>
                                                        </MultiBinding>
                                                    </TextBlock.Text>
                                                </TextBlock>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                            
                            <!-- Ã–ÄŸe ButonlarÄ± -->
                            <StackPanel Orientation="Horizontal" Spacing="3">
                                <Button Content="+ Metin" Command="{Binding AddTextCommand}" Padding="6,3" FontSize="10"/>
                                <Button Content="+ Sembol" Command="{Binding AddSymbolCommand}" Padding="6,3" FontSize="10"/>
                                <Button Content="Sil" Command="{Binding DeleteItemCommand}" Padding="6,3" FontSize="10"/>
                                <Button Content="Kopyala" Command="{Binding DuplicateCommand}" Padding="6,3" FontSize="10"/>
                            </StackPanel>
                        </StackPanel>
                        
                    </StackPanel>
                </ScrollViewer>
            </Border>
            
            <!-- Orta Panel: GÃ¶rsel Canvas -->
            <Border Grid.Column="1" Background="#1A1A1A" CornerRadius="6" Margin="4,0" ClipToBounds="True">
                <Grid RowDefinitions="Auto,*,Auto">
                    <!-- Ãœst: Zoom ve Playback kontrolleri -->
                    <!-- Requirements: 7.1, 7.4, 7.5 -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="4" Margin="8,6">
                        <TextBlock Text="{Binding DisplaySize}" Foreground="#808080" FontSize="10" VerticalAlignment="Center"/>
                        <Border Width="1" Background="#404040" Margin="8,0"/>
                        <Button Content="-" Width="22" Height="22" Command="{Binding ZoomOutCommand}" FontSize="10"/>
                        <TextBlock Text="{Binding ZoomLevel, StringFormat='{}{0}%'}" Foreground="#E0E0E0" FontSize="10" 
                                   VerticalAlignment="Center" Width="35" TextAlignment="Center"/>
                        <Button Content="+" Width="22" Height="22" Command="{Binding ZoomInCommand}" FontSize="10"/>
                        <Border Width="1" Background="#404040" Margin="8,0"/>
                        <ToggleButton IsChecked="{Binding IsSnapEnabled}" ToolTip.Tip="MÄ±knatÄ±s (Snap)" 
                                      Width="22" Height="22" FontSize="10" Padding="0">
                            <TextBlock Text="ðŸ§²" FontSize="12"/>
                        </ToggleButton>
                        <Border Width="1" Background="#404040" Margin="8,0"/>
                        
                        <!-- Program Playback Kontrolleri -->
                        <!-- Requirements: 7.1, 7.4, 7.5 -->
                        <Button Content="â®" Width="24" Height="22" Command="{Binding PreviousProgramCommand}" 
                                ToolTip.Tip="Ã–nceki Program" FontSize="12" Padding="0"/>
                        <Button Width="28" Height="22" FontSize="10" Padding="0"
                                ToolTip.Tip="Oynat/Duraklat"
                                Click="OnPlayPauseToggle">
                            <TextBlock Text="{Binding IsAnimationPlaying, Converter={x:Static vm:BoolToPlayPauseIconConverter.Instance}}" 
                                       FontSize="12" 
                                       Foreground="{Binding IsAnimationPlaying, Converter={x:Static vm:BoolToPlayColorConverter.Instance}}"/>
                        </Button>
                        <Button Content="â­" Width="24" Height="22" Command="{Binding NextProgramCommand}" 
                                ToolTip.Tip="Sonraki Program" FontSize="12" Padding="0"/>
                        <Border Background="#1E1E1E" CornerRadius="3" Padding="6,2" Margin="4,0,0,0">
                            <TextBlock Text="{Binding CurrentProgramDisplay}" Foreground="#B0B0B0" FontSize="10" 
                                       VerticalAlignment="Center" ToolTip.Tip="Mevcut Program / Toplam"/>
                        </Border>
                    </StackPanel>
                    
                    <!-- Canvas AlanÄ± -->
                    <Border Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Center"
                            Background="#000000" BorderBrush="#404040" BorderThickness="2"
                            Width="{Binding CanvasWidth}" Height="{Binding CanvasHeight}">
                        <Canvas x:Name="ZoneCanvas" Background="Transparent"
                                PointerPressed="OnCanvasPointerPressed"
                                PointerMoved="OnCanvasPointerMoved"
                                PointerReleased="OnCanvasPointerReleased"/>
                    </Border>
                    
                    <!-- Alt: Status Bar -->
                    <!-- Requirements: 10.5, 10.6 -->
                    <Grid Grid.Row="2" ColumnDefinitions="Auto,*,Auto" Margin="8,6">
                        <!-- Sol: Koordinat -->
                        <Border Grid.Column="0" Background="#80000000" CornerRadius="4" Padding="6,3">
                            <TextBlock Text="{Binding MousePosition}" Foreground="#FFFFFF" FontSize="9"/>
                        </Border>
                        
                        <!-- Orta: Program ve Ara Durak Durumu -->
                        <Border Grid.Column="1" Background="#80000000" CornerRadius="4" Padding="6,3" 
                                Margin="8,0" HorizontalAlignment="Center">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <!-- Program Durumu -->
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <TextBlock Text="ðŸ“‹" FontSize="9" Foreground="#808080" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding SelectedProgram.Name, FallbackValue='Program Yok'}" 
                                               Foreground="#B0B0B0" FontSize="9" VerticalAlignment="Center"/>
                                    <Border Width="6" Height="6" CornerRadius="3" VerticalAlignment="Center"
                                            Background="{Binding IsAnimationPlaying, Converter={x:Static vm:BoolToPlayColorConverter.Instance}}"/>
                                </StackPanel>
                                
                                <!-- Ara Durak Durumu (Sadece ara durak aktifken) -->
                                <StackPanel Orientation="Horizontal" Spacing="4" 
                                            IsVisible="{Binding SelectedItem.IntermediateStops.IsEnabled, FallbackValue=False}">
                                    <TextBlock Text="â€¢" FontSize="9" Foreground="#606060" VerticalAlignment="Center"/>
                                    <TextBlock Text="ðŸš" FontSize="9" Foreground="#808080" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding CurrentStopDisplay, FallbackValue='Durak Yok'}" 
                                               Foreground="#B0B0B0" FontSize="9" VerticalAlignment="Center"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                        
                        <!-- SaÄŸ: Oynatma Durumu -->
                        <Border Grid.Column="2" Background="#80000000" CornerRadius="4" Padding="6,3">
                            <TextBlock Text="{Binding PlaybackStatusText}" Foreground="#B0B0B0" FontSize="9"/>
                        </Border>
                    </Grid>
                </Grid>
            </Border>
            
            <!-- SaÄŸ Panel: Ã–ÄŸe AyarlarÄ± -->
            <Border Grid.Column="2" Background="#252525" CornerRadius="6" Padding="8" Margin="4,0,0,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="8" IsVisible="{Binding HasSelection}">
                        
                        <!-- Ã–ÄŸe AdÄ± -->
                        <StackPanel Spacing="2">
                            <TextBlock Text="Ad" Foreground="#808080" FontSize="10"/>
                            <TextBox Text="{Binding SelectedItem.Name}" FontSize="11"/>
                        </StackPanel>
                        
                        <!-- Ä°Ã§erik (Metin iÃ§in) -->
                        <StackPanel Spacing="2" IsVisible="{Binding IsTextItemSelected}">
                            <TextBlock Text="Ä°Ã§erik" Foreground="#808080" FontSize="10"/>
                            <TextBox Text="{Binding SelectedItem.Content}" FontSize="11" AcceptsReturn="True" 
                                     TextWrapping="Wrap" Height="40"/>
                        </StackPanel>
                        
                        <!-- Font (Metin iÃ§in) -->
                        <StackPanel Spacing="2" IsVisible="{Binding IsTextItemSelected}">
                            <TextBlock Text="Font" Foreground="#808080" FontSize="10"/>
                            <ComboBox ItemsSource="{Binding FontNames}" SelectedItem="{Binding SelectedItem.FontName}"
                                      HorizontalAlignment="Stretch" FontSize="11"/>
                        </StackPanel>
                        
                        <!-- Sembol SeÃ§ici -->
                        <StackPanel Spacing="4" IsVisible="{Binding IsSymbolItemSelected}">
                            <TextBlock Text="Sembol" Foreground="#808080" FontSize="10"/>
                            <ComboBox SelectedIndex="0" SelectionChanged="OnSymbolCategoryChanged" x:Name="SymbolCategoryCombo"
                                      HorizontalAlignment="Stretch" FontSize="10">
                                <ComboBoxItem Content="TÃ¼mÃ¼" Tag="all"/>
                                <ComboBoxItem Content="Bayraklar" Tag="flags"/>
                                <ComboBoxItem Content="EriÅŸilebilirlik" Tag="accessibility"/>
                                <ComboBoxItem Content="YÃ¶n OklarÄ±" Tag="arrows"/>
                                <ComboBoxItem Content="UlaÅŸÄ±m" Tag="transport"/>
                            </ComboBox>
                            <Border Background="#1E1E1E" CornerRadius="4" Padding="2" Height="80">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ItemsControl ItemsSource="{Binding FilteredSymbols}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel Orientation="Horizontal"/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Button Width="32" Height="32" Margin="1" Padding="2"
                                                        ToolTip.Tip="{Binding DisplayName}"
                                                        Click="OnSymbolSelected" Tag="{Binding Name}" Background="#2D2D2D">
                                                    <TextBlock Text="{Binding DisplayName}" FontSize="7" TextWrapping="Wrap"
                                                               TextAlignment="Center" Foreground="#E0E0E0"
                                                               VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                                </Button>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Border>
                        </StackPanel>
                        
                        <Border Height="1" Background="#3D3D3D"/>
                        
                        <!-- Pozisyon ve Boyut -->
                        <TextBlock Text="Pozisyon / Boyut" FontWeight="SemiBold" Foreground="#E0E0E0" FontSize="11"/>
                        <Grid ColumnDefinitions="Auto,*,Auto,*" RowDefinitions="Auto,Auto" Margin="0,4,0,0">
                            <TextBlock Grid.Row="0" Grid.Column="0" Text="X:" Foreground="#808080" FontSize="9" VerticalAlignment="Center" Margin="0,0,4,0"/>
                            <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SelectedItem.X}" FontSize="10" Margin="0,0,6,2"/>
                            <TextBlock Grid.Row="0" Grid.Column="2" Text="Y:" Foreground="#808080" FontSize="9" VerticalAlignment="Center" Margin="0,0,4,0"/>
                            <TextBox Grid.Row="0" Grid.Column="3" Text="{Binding SelectedItem.Y}" FontSize="10" Margin="0,0,0,2"/>
                            
                            <TextBlock Grid.Row="1" Grid.Column="0" Text="W:" Foreground="#808080" FontSize="9" VerticalAlignment="Center" Margin="0,0,4,0"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding SelectedItem.Width}" FontSize="10" Margin="0,2,6,0"/>
                            <TextBlock Grid.Row="1" Grid.Column="2" Text="H:" Foreground="#808080" FontSize="9" VerticalAlignment="Center" Margin="0,0,4,0"/>
                            <TextBox Grid.Row="1" Grid.Column="3" Text="{Binding SelectedItem.Height}" FontSize="10" Margin="0,2,0,0"/>
                        </Grid>
                        
                        <!-- Harf AralÄ±ÄŸÄ± (Metin iÃ§in) -->
                        <StackPanel Spacing="2" IsVisible="{Binding IsTextItemSelected}" Margin="0,4,0,0">
                            <Grid ColumnDefinitions="Auto,*,Auto">
                                <TextBlock Grid.Column="0" Text="Harf AralÄ±ÄŸÄ±:" Foreground="#808080" FontSize="9" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" Minimum="0" Maximum="10" Value="{Binding SelectedItem.LetterSpacing}" 
                                        Margin="6,0" TickFrequency="1" IsSnapToTickEnabled="True"/>
                                <TextBlock Grid.Column="2" Text="{Binding SelectedItem.LetterSpacing, StringFormat={}{0}px}" 
                                           Foreground="#B0B0B0" FontSize="9" Width="25" VerticalAlignment="Center"/>
                            </Grid>
                        </StackPanel>
                        
                        <Border Height="1" Background="#3D3D3D"/>
                        
                        <!-- Renk -->
                        <TextBlock Text="Renk" FontWeight="SemiBold" Foreground="#E0E0E0" FontSize="11"/>
                        <WrapPanel Orientation="Horizontal">
                            <Button Width="24" Height="24" Background="#FF0000" Margin="1" Click="OnColorRed"/>
                            <Button Width="24" Height="24" Background="#00FF00" Margin="1" Click="OnColorGreen"/>
                            <Button Width="24" Height="24" Background="#FFB000" Margin="1" Click="OnColorAmber"/>
                            <Button Width="24" Height="24" Background="#FFFFFF" Margin="1" Click="OnColorWhite"/>
                            <Button Width="24" Height="24" Background="#00FFFF" Margin="1" Click="OnColorCyan"/>
                            <Button Width="24" Height="24" Background="#FFFF00" Margin="1" Click="OnColorYellow"/>
                        </WrapPanel>
                        
                        <!-- Ã‡ok Renkli Metin (Sadece metin Ã¶ÄŸeleri iÃ§in) -->
                        <StackPanel Spacing="4" IsVisible="{Binding IsTextItemSelected}">
                            <Border Height="1" Background="#3D3D3D" Margin="0,4,0,4"/>
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <TextBlock Text="Ã‡ok Renkli" FontWeight="SemiBold" Foreground="#E0E0E0" FontSize="11" VerticalAlignment="Center"/>
                                <Button x:Name="ColoredModeToggle" 
                                        Content="{Binding SelectedItem.UseColoredSegments, Converter={x:Static vm:BoolToOnOffConverter.Instance}}"
                                        FontSize="9" Padding="6,2" MinWidth="45"
                                        Click="OnColoredModeToggle"/>
                            </StackPanel>
                            
                            <!-- Ã‡ok renkli mod aktifken gÃ¶ster -->
                            <StackPanel Spacing="4" IsVisible="{Binding SelectedItem.UseColoredSegments}">
                                <!-- HazÄ±r Åžablonlar -->
                                <StackPanel Orientation="Horizontal" Spacing="3" Margin="0,2,0,0">
                                    <Button Content="ðŸŒˆ" ToolTip.Tip="GÃ¶kkuÅŸaÄŸÄ±" Width="26" Height="22" FontSize="12" 
                                            Click="OnApplyRainbow" Padding="0"/>
                                    <Button Content="â†”" ToolTip.Tip="Gradient (KÄ±rmÄ±zÄ±â†’YeÅŸil)" Width="26" Height="22" FontSize="10" 
                                            Click="OnApplyGradientRG" Padding="0"/>
                                    <Button Content="â†”" ToolTip.Tip="Gradient (Maviâ†’SarÄ±)" Width="26" Height="22" FontSize="10" 
                                            Click="OnApplyGradientBY" Padding="0" Foreground="#00AAFF"/>
                                </StackPanel>
                                
                                <!-- Harf Listesi -->
                                <TextBlock Text="Harfler:" Foreground="#808080" FontSize="9" Margin="0,4,0,2"/>
                                <Border Background="#1E1E1E" CornerRadius="4" Padding="2" MaxHeight="100">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <ItemsControl ItemsSource="{Binding SelectedItem.ColoredSegments}" x:Name="SegmentList">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate DataType="models:ColoredTextSegment">
                                                    <Border Background="#2D2D2D" CornerRadius="3" Padding="4,2" Margin="1"
                                                            PointerPressed="OnSegmentClick">
                                                        <Grid ColumnDefinitions="Auto,*,Auto">
                                                            <Border Grid.Column="0" Width="14" Height="14" CornerRadius="2"
                                                                    Background="{Binding Color, Converter={x:Static vm:ColorToBrushConverter.Instance}}"
                                                                    Margin="0,0,4,0"/>
                                                            <TextBlock Grid.Column="1" Text="{Binding Text}" FontSize="11" 
                                                                       Foreground="#E0E0E0" VerticalAlignment="Center" FontWeight="Bold"/>
                                                            <!-- Renk deÄŸiÅŸtirme butonlarÄ± -->
                                                            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="1">
                                                                <Button Width="14" Height="14" Background="#FF0000" Padding="0" 
                                                                        Click="OnSegmentColorRed" Tag="{Binding}" FontSize="1"/>
                                                                <Button Width="14" Height="14" Background="#00FF00" Padding="0" 
                                                                        Click="OnSegmentColorGreen" Tag="{Binding}" FontSize="1"/>
                                                                <Button Width="14" Height="14" Background="#FFB000" Padding="0" 
                                                                        Click="OnSegmentColorAmber" Tag="{Binding}" FontSize="1"/>
                                                                <Button Width="14" Height="14" Background="#00FFFF" Padding="0" 
                                                                        Click="OnSegmentColorCyan" Tag="{Binding}" FontSize="1"/>
                                                                <Button Width="14" Height="14" Background="#FFFF00" Padding="0" 
                                                                        Click="OnSegmentColorYellow" Tag="{Binding}" FontSize="1"/>
                                                            </StackPanel>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </ScrollViewer>
                                </Border>
                            </StackPanel>
                        </StackPanel>
                        
                        <Border Height="1" Background="#3D3D3D"/>
                        
                        <!-- Hizalama -->
                        <TextBlock Text="Hizalama" FontWeight="SemiBold" Foreground="#E0E0E0" FontSize="11"/>
                        <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto">
                            <StackPanel Grid.Column="0" Grid.Row="0" Spacing="2">
                                <TextBlock Text="Yatay" Foreground="#808080" FontSize="9"/>
                                <ComboBox SelectedIndex="{Binding SelectedItem.HAlign, Converter={x:Static vm:HAlignToIndexConverter.Instance}}"
                                          SelectionChanged="OnHAlignChanged" HorizontalAlignment="Stretch" FontSize="10">
                                    <ComboBoxItem Content="Sol"/>
                                    <ComboBoxItem Content="Orta"/>
                                    <ComboBoxItem Content="SaÄŸ"/>
                                </ComboBox>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Grid.Row="0" Spacing="2" Margin="4,0,0,0">
                                <TextBlock Text="Dikey" Foreground="#808080" FontSize="9"/>
                                <ComboBox SelectedIndex="{Binding SelectedItem.VAlign, Converter={x:Static vm:VAlignToIndexConverter.Instance}}"
                                          SelectionChanged="OnVAlignChanged" HorizontalAlignment="Stretch" FontSize="10">
                                    <ComboBoxItem Content="Ãœst"/>
                                    <ComboBoxItem Content="Orta"/>
                                    <ComboBoxItem Content="Alt"/>
                                </ComboBox>
                            </StackPanel>
                        </Grid>
                        
                        <Border Height="1" Background="#3D3D3D"/>
                        
                        <!-- Kayan YazÄ± -->
                        <CheckBox Content="Kayan YazÄ±" IsChecked="{Binding SelectedItem.IsScrolling}" FontSize="11"
                                  IsVisible="{Binding IsTextItemSelected}"/>
                        <StackPanel Spacing="4" IsVisible="{Binding IsScrollingItemSelected}">
                            <Grid ColumnDefinitions="*,*">
                                <StackPanel Grid.Column="0" Spacing="2" Margin="0,0,2,0">
                                    <TextBlock Text="YÃ¶n" Foreground="#808080" FontSize="9"/>
                                    <ComboBox SelectedIndex="{Binding SelectedItem.ScrollDirection, Converter={x:Static vm:ScrollDirToIndexConverter.Instance}}"
                                              HorizontalAlignment="Stretch" FontSize="10">
                                        <ComboBoxItem Content="â† Sol"/>
                                        <ComboBoxItem Content="â†’ SaÄŸ"/>
                                        <ComboBoxItem Content="â†‘ YukarÄ±"/>
                                        <ComboBoxItem Content="â†“ AÅŸaÄŸÄ±"/>
                                    </ComboBox>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Spacing="2" Margin="2,0,0,0">
                                    <TextBlock Text="HÄ±z" Foreground="#808080" FontSize="9"/>
                                    <Slider Minimum="1" Maximum="100" Value="{Binding SelectedItem.ScrollSpeed}" 
                                            TickFrequency="10" IsSnapToTickEnabled="False"/>
                                </StackPanel>
                            </Grid>
                            <Border Background="#1E3A1E" CornerRadius="4" Padding="6,4">
                                <TextBlock Text="â–¶ YukarÄ±daki play butonuna tÄ±klayÄ±n" Foreground="#80FF80" FontSize="9" 
                                           HorizontalAlignment="Center"/>
                            </Border>
                        </StackPanel>
                        
                        <Border Height="1" Background="#3D3D3D"/>
                        
                        <!-- Ã‡erÃ§eve AyarlarÄ± -->
                        <StackPanel Spacing="4">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <CheckBox Content="Ã‡erÃ§eve" IsChecked="{Binding SelectedItem.Border.IsEnabled}" FontSize="11"/>
                                <Border Width="18" Height="18" CornerRadius="3"
                                        Background="{Binding SelectedItem.Border.Color, Converter={x:Static vm:ColorToBrushConverter.Instance}}"
                                        BorderBrush="#505050" BorderThickness="1"
                                        ToolTip.Tip="Ã‡erÃ§eve Rengi"/>
                            </StackPanel>
                            
                            <StackPanel Spacing="4" IsVisible="{Binding SelectedItem.Border.IsEnabled}">
                                <!-- Ã‡erÃ§eve Renkleri -->
                                <WrapPanel Orientation="Horizontal" Margin="0,2,0,0">
                                    <Button Width="20" Height="20" Background="#FF0000" Margin="1" Click="OnBorderColorRed" Padding="0" ToolTip.Tip="KÄ±rmÄ±zÄ±"/>
                                    <Button Width="20" Height="20" Background="#00FF00" Margin="1" Click="OnBorderColorGreen" Padding="0" ToolTip.Tip="YeÅŸil"/>
                                    <Button Width="20" Height="20" Background="#FFB000" Margin="1" Click="OnBorderColorAmber" Padding="0" ToolTip.Tip="Amber"/>
                                    <Button Width="20" Height="20" Background="#FFFFFF" Margin="1" Click="OnBorderColorWhite" Padding="0" ToolTip.Tip="Beyaz"/>
                                    <Button Width="20" Height="20" Background="#00FFFF" Margin="1" Click="OnBorderColorCyan" Padding="0" ToolTip.Tip="Cyan"/>
                                    <Button Width="20" Height="20" Background="#FFFF00" Margin="1" Click="OnBorderColorYellow" Padding="0" ToolTip.Tip="SarÄ±"/>
                                </WrapPanel>
                                
                                <!-- Yatay Ã‡izgi -->
                                <Grid ColumnDefinitions="Auto,Auto,Auto">
                                    <TextBlock Grid.Column="0" Text="Yatay:" Foreground="#808080" FontSize="9" VerticalAlignment="Center" Width="40"/>
                                    <NumericUpDown Grid.Column="1" Minimum="1" Maximum="5" Value="{Binding SelectedItem.Border.HorizontalLines}" 
                                                   Increment="1" Width="60" ShowButtonSpinner="True"/>
                                    <TextBlock Grid.Column="2" Text="{Binding SelectedItem.Border.HorizontalLines, StringFormat={}{0}px}" 
                                               Foreground="#B0B0B0" FontSize="9" VerticalAlignment="Center" Margin="4,0,0,0"/>
                                </Grid>
                                
                                <!-- Dikey Ã‡izgi -->
                                <Grid ColumnDefinitions="Auto,Auto,Auto">
                                    <TextBlock Grid.Column="0" Text="Dikey:" Foreground="#808080" FontSize="9" VerticalAlignment="Center" Width="40"/>
                                    <NumericUpDown Grid.Column="1" Minimum="1" Maximum="5" Value="{Binding SelectedItem.Border.VerticalLines}" 
                                                   Increment="1" Width="60" ShowButtonSpinner="True"/>
                                    <TextBlock Grid.Column="2" Text="{Binding SelectedItem.Border.VerticalLines, StringFormat={}{0}px}" 
                                               Foreground="#B0B0B0" FontSize="9" VerticalAlignment="Center" Margin="4,0,0,0"/>
                                </Grid>
                                
                                <!-- BoÅŸluk -->
                                <Grid ColumnDefinitions="Auto,Auto,Auto">
                                    <TextBlock Grid.Column="0" Text="BoÅŸluk:" Foreground="#808080" FontSize="9" VerticalAlignment="Center" Width="40"/>
                                    <NumericUpDown Grid.Column="1" Minimum="0" Maximum="10" Value="{Binding SelectedItem.Border.Padding}" 
                                                   Increment="1" Width="60" ShowButtonSpinner="True"/>
                                    <TextBlock Grid.Column="2" Text="{Binding SelectedItem.Border.Padding, StringFormat={}{0}px}" 
                                               Foreground="#B0B0B0" FontSize="9" VerticalAlignment="Center" Margin="4,0,0,0"/>
                                </Grid>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Ara Duraklar BÃ¶lÃ¼mÃ¼ (Sadece metin Ã¶ÄŸeleri iÃ§in) -->
                        <!-- Requirements: 10.3, 10.4, 4.2, 4.3, 4.4, 5.6, 6.1 -->
                        <StackPanel Spacing="4" IsVisible="{Binding IsTextItemSelected}">
                            <Border Height="1" Background="#3D3D3D" Margin="0,4,0,4"/>
                            
                            <!-- BaÅŸlÄ±k ve Toggle -->
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="Ara Duraklar" FontWeight="SemiBold" Foreground="#E0E0E0" FontSize="11" VerticalAlignment="Center"/>
                                <CheckBox IsChecked="{Binding SelectedItem.IntermediateStops.IsEnabled}" 
                                          ToolTip.Tip="Ara durak sistemini aktif/pasif yap"/>
                            </StackPanel>
                            
                            <!-- Ara Durak Ä°Ã§eriÄŸi (Aktifken gÃ¶rÃ¼nÃ¼r) -->
                            <StackPanel Spacing="4" IsVisible="{Binding SelectedItem.IntermediateStops.IsEnabled}">
                                
                                <!-- Durak Listesi -->
                                <Border Background="#1E1E1E" CornerRadius="4" Padding="4" MaxHeight="100">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="0,0,4,0">
                                        <ListBox ItemsSource="{Binding SelectedItem.IntermediateStops.Stops}"
                                                 SelectedIndex="{Binding SelectedStopIndex}"
                                                 Background="Transparent"
                                                 BorderThickness="0"
                                                 x:Name="StopListBox">
                                            <ListBox.ItemTemplate>
                                                <DataTemplate DataType="models:IntermediateStop">
                                                    <Border Background="#2D2D2D" CornerRadius="3" Padding="4,2" Margin="1">
                                                        <Grid ColumnDefinitions="Auto,*">
                                                            <TextBlock Grid.Column="0" FontSize="9" Foreground="#808080" 
                                                                       VerticalAlignment="Center" Margin="0,0,6,0">
                                                                <TextBlock.Text>
                                                                    <MultiBinding StringFormat="{}{0}.">
                                                                        <Binding Path="Order"/>
                                                                    </MultiBinding>
                                                                </TextBlock.Text>
                                                            </TextBlock>
                                                            <TextBox Grid.Column="1" Text="{Binding StopName}" 
                                                                     FontSize="10" Foreground="#E0E0E0" 
                                                                     Background="Transparent" BorderThickness="0"
                                                                     Padding="2,1"/>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>
                                    </ScrollViewer>
                                </Border>
                                
                                <!-- Durak Ekleme -->
                                <Grid ColumnDefinitions="*,Auto" Margin="0,2,0,0">
                                    <TextBox Grid.Column="0" x:Name="NewStopNameTextBox" 
                                             Watermark="Yeni durak adÄ±..." FontSize="10"
                                             KeyDown="OnNewStopKeyDown"
                                             Margin="0,0,4,0"/>
                                    <Button Grid.Column="1" Content="+" Width="26" Height="26" 
                                            Click="OnAddStopClick"
                                            ToolTip.Tip="Durak ekle" FontSize="14" Padding="0"
                                            HorizontalContentAlignment="Center" VerticalContentAlignment="Center"/>
                                </Grid>
                                
                                <!-- Durak Kontrol ButonlarÄ± -->
                                <StackPanel Orientation="Horizontal" Spacing="2">
                                    <Button Content="Sil" Command="{Binding RemoveIntermediateStopCommand}" 
                                            Padding="6,2" FontSize="9" ToolTip.Tip="SeÃ§ili duraÄŸÄ± sil"/>
                                    <Button Content="â–²" Command="{Binding MoveStopUpCommand}" 
                                            Padding="6,2" FontSize="9" ToolTip.Tip="YukarÄ± taÅŸÄ±"/>
                                    <Button Content="â–¼" Command="{Binding MoveStopDownCommand}" 
                                            Padding="6,2" FontSize="9" ToolTip.Tip="AÅŸaÄŸÄ± taÅŸÄ±"/>
                                </StackPanel>
                                
                                <Border Height="1" Background="#3D3D3D" Margin="0,2,0,2"/>
                                
                                <!-- SÃ¼re AyarÄ± -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <StackPanel Grid.Column="0" Spacing="2">
                                        <TextBlock Text="Durak SÃ¼resi (sn)" Foreground="#808080" FontSize="9"/>
                                        <Slider Minimum="0.5" Maximum="10" 
                                                Value="{Binding SelectedItem.IntermediateStops.DurationSeconds}" 
                                                TickFrequency="0.5" IsSnapToTickEnabled="True"
                                                IsEnabled="{Binding !SelectedItem.IntermediateStops.AutoCalculateDuration}"/>
                                    </StackPanel>
                                    <TextBlock Grid.Column="1" 
                                               Text="{Binding SelectedItem.IntermediateStops.DurationSeconds, StringFormat={}{0:F1}sn}" 
                                               Foreground="#B0B0B0" FontSize="10" VerticalAlignment="Bottom" Margin="4,0,0,0" Width="35"/>
                                </Grid>
                                
                                <!-- Otomatik SÃ¼re Hesaplama -->
                                <CheckBox Content="Otomatik sÃ¼re hesapla" FontSize="9"
                                          IsChecked="{Binding SelectedItem.IntermediateStops.AutoCalculateDuration}"
                                          ToolTip.Tip="Aktifken: sÃ¼re = program_sÃ¼resi / durak_sayÄ±sÄ±"/>
                                
                                <!-- Animasyon Tipi -->
                                <StackPanel Spacing="2">
                                    <TextBlock Text="GeÃ§iÅŸ Animasyonu" Foreground="#808080" FontSize="9"/>
                                    <ComboBox SelectedIndex="{Binding SelectedItem.IntermediateStops.Animation, Converter={x:Static vm:StopAnimationToIndexConverter.Instance}}"
                                              SelectionChanged="OnStopAnimationChanged"
                                              HorizontalAlignment="Stretch" FontSize="10">
                                        <ComboBoxItem Content="Direkt (Kesme)"/>
                                        <ComboBoxItem Content="Solma (Fade)"/>
                                        <ComboBoxItem Content="YukarÄ± Kayma"/>
                                        <ComboBoxItem Content="AÅŸaÄŸÄ± Kayma"/>
                                    </ComboBox>
                                </StackPanel>
                                
                                <!-- Animasyon SÃ¼resi -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <StackPanel Grid.Column="0" Spacing="2">
                                        <TextBlock Text="Animasyon SÃ¼resi (ms)" Foreground="#808080" FontSize="9"/>
                                        <Slider Minimum="100" Maximum="500" 
                                                Value="{Binding SelectedItem.IntermediateStops.AnimationDurationMs}" 
                                                TickFrequency="50" IsSnapToTickEnabled="True"/>
                                    </StackPanel>
                                    <TextBlock Grid.Column="1" 
                                               Text="{Binding SelectedItem.IntermediateStops.AnimationDurationMs, StringFormat={}{0}ms}" 
                                               Foreground="#B0B0B0" FontSize="10" VerticalAlignment="Bottom" Margin="4,0,0,0" Width="40"/>
                                </Grid>
                                
                            </StackPanel>
                        </StackPanel>
                        
                    </StackPanel>
                </ScrollViewer>
            </Border>
            
        </Grid>
    </Border>

</UserControl>
